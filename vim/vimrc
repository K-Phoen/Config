" Set title on X window
set title

" make plugins smoother (don't redraw while executing macros)
set lazyredraw

" Redifinition of map leader
let mapleader = ","

" Add a line under the cursor (reverse color)
set cursorline

" Behaviors
set nocompatible
set encoding=utf-8
set backspace=indent,eol,start
set autoindent                  " Always set autoindenting on
set copyindent                  " copy the previous indentation on autoindenting
set ruler                       " Always show current positions along the bottom
set number                      " turn on line numbers

set nobackup                    " Don't make a backup before overwriting a file
set nowritebackup               " And again.
set noswapfile                  " Use an SCM instead of swap files

set shell=zsh                   " Use Zsh as default shell
set wildmenu                    " Enhanced command line completion.
set wildignore=.svn,CVS,.git,.hg,*.o,*.a,*.class,*.mo,*.la,*.so,*.obj,*.swp,*.jpg,*.png,*.xpm,*.gif,*.pyc,*.pyo,*/cache/**,*/logs/**,*/zend/** " Ignore certain files

" Uncomment the following to have Vim jump to the last position when reopening
" a file
au BufReadPost * if line("'\"") > 0 && line("'\"") <= line("$")
    \| exe "normal! g'\"" | endif

" redefine tabs
set expandtab       " no real tabs please!
set shiftwidth=2    " auto-indent amount when using cindent, >>, << and stuff
                    " like that
set softtabstop=2   " when hitting tab or backspace, how many spaces should a
                    " tab be (see expandtab)
set tabstop=2       " real tabs should be 2

set list
set listchars=tab:▸\ , " display special chars for tabs

set complete=.,w,b,u,t,i,k~/.vim/syntax/php.api

set scrolloff=5     " Keep x line for scope while scrolling
set sidescrolloff=5

set formatoptions+=or " see http://stackoverflow.com/questions/3298820/vim-phpdoc-multiline-comment-autoindent/3303017#3303017
set wrap            " long lines wrap and continue to the next line



" Search
"=======

set hlsearch        " Highlight search matches
set incsearch       " ...dynamically as they are typed.
" Clear search highlight
map <silent> <C-H> :let @/=""<CR>:echo "Cleared search register."<cr>

" These two options, when set together, will make /-style searches
" case-sensitive only if there is a capital letter in the search expression.
" *-style searches continue to be consistently case-sensitive.
set ignorecase
set smartcase



" Pathogen
"=========
" Use pathogen to easily modify the runtime path to include all
" plugins under the ~/.vim/bundle directory
call pathogen#infect()

" Enable syntax highlighting
syntax on

" enable filetypes
filetype on
filetype plugin indent on



" Theme setup
"============

let &t_Co=256         " force the 256-color mode
let g:solarized_termcolors=256
set background=dark
colorscheme solarized


" Highlight unwanted spaces
highlight ExtraWhitespace ctermbg=red guibg=red
match ExtraWhitespace /\s\+$/
autocmd BufWinEnter * match ExtraWhitespace /\s\+\%#\@<!$/
autocmd InsertEnter * match ExtraWhitespace /\s\+\%#\@<!$/
autocmd InsertLeave * match ExtraWhitespace /\s\+\%#\@<!$/
autocmd BufWinLeave * call clearmatches()


" Toggle line numbers and fold column for easy copying:
nnoremap <C-l> :set nonumber!<CR>:set foldcolumn=0<CR>

" Trim trailing spaces
map <leader>t :%s/\s\+$<CR>

" Start a substitute
map <leader>s :%s/

" Start a search
map <leader>h /<C-r>=expand("<cword>")<CR>

" Pull word under cursor into LHS of a substitute (for quick search and
" replace)
nmap <leader>S :%s/<C-r>=expand("<cword>")<CR>/

" Sudo to write
command W w !sudo tee % > /dev/null

" edit vimrc in a new tab
nnoremap <leader>ev :tabnew $MYVIMRC<CR>

map <silent><leader><Right> <C-T> " go to the declaration of a class, variable, ...)
map <silent><leader><Left> <C-]>  " go back

" http://vim.wikia.com/wiki/Toggle_auto-indenting_for_code_paste
" F2 = toggle paste mode
nnoremap <F2> :set invpaste paste?<Enter>
imap <F2> <C-O><F2>
set pastetoggle=<F2>


" Plugin specifics
"=================

" define my name for snipmate plugin
let g:snips_author = 'Kévin Gomez <contact@kevingomez.fr>'
let g:snips_company = ''

" vim-powerline
set laststatus=2
let g:Powerline_symbols = 'unicode'

" tagbar
let g:tagbar_left = 1           " display the tagbar on the left side
set updatetime=500              " show tags' prototype after 500 milliseconds
let g:tagbar_width = 25         " width in characters of the tagbar
let g:tagbar_autoshowtag = 1    " always show the current tag in the tagbar
let g:tagbar_autofocus = 1      " the cursor will move to the Tagbar window when it is opened.
nnoremap <silent> <F10> :TagbarToggle<CR>

" Syntastic
let g:syntastic_auto_loc_list = 1   " auto open/close the errors list
let g:syntastic_quiet_warnings = 1  " we don't want the warnings to be displayed

" NerdTree
map <leader>n :NERDTreeToggle<CR>

" Ctags
set tags=./tags;/,~/.vimtags,tags,vendor.tags

" ctrlp
let g:ctrlp_custom_ignore = {
    \ 'dir':  '\.git$\|\.hg$\|\.svn$',
    \ 'file': '\.exe$\|\.so$\|\.dll$' }
let g:ctrlp_clear_cache_on_exit = 0

" OmniComplete
if has("autocmd") && exists("+omnifunc")
    autocmd Filetype *
        \if &omnifunc == "" |
        \setlocal omnifunc=syntaxcomplete#Complete |
        \endif
endif

hi Pmenu  guifg=#000000 guibg=#F8F8F8 ctermfg=black ctermbg=Lightgray
hi PmenuSbar  guifg=#8A95A7 guibg=#F8F8F8 gui=NONE ctermfg=darkcyan ctermbg=lightgray cterm=NONE
hi PmenuThumb  guifg=#F8F8F8 guibg=#8A95A7 gui=NONE ctermfg=lightgray ctermbg=darkcyan cterm=NONE

" Automatically open and close the popup menu / preview window
au CursorMovedI,InsertLeave * if pumvisible() == 0|silent! pclose|endif
set completeopt=menu,preview,longest

" PIV
let g:DisableAutoPHPFolding = 1
let g:PIVAutoClose = 0

" neocomplcache
let g:acp_enableAtStartup = 0
let g:neocomplcache_enable_at_startup = 1
let g:neocomplcache_enable_camel_case_completion = 1
let g:neocomplcache_enable_smart_case = 1
let g:neocomplcache_enable_auto_delimiter = 1
let g:neocomplcache_max_list = 15
let g:neocomplcache_force_overwrite_completefunc = 1

" SuperTab like snippets behavior.
imap <silent><expr><TAB> neosnippet#expandable() ?
            \ "\<Plug>(neosnippet_expand_or_jump)" : (pumvisible() ?
            \ "\<C-e>" : "\<TAB>")
smap <TAB> <Right><Plug>(neosnippet_jump_or_expand)

" Define dictionary.
let g:neocomplcache_dictionary_filetype_lists = {
            \ 'default' : '',
            \ 'vimshell' : $HOME.'/.vimshell_hist',
            \ 'scheme' : $HOME.'/.gosh_completions'
            \ }

" Define keyword.
if !exists('g:neocomplcache_keyword_patterns')
    let g:neocomplcache_keyword_patterns = {}
endif
let g:neocomplcache_keyword_patterns._ = '\h\w*'

" Plugin key-mappings.
imap <C-k> <Plug>(neosnippet_expand_or_jump)
smap <C-k> <Plug>(neosnippet_expand_or_jump)
inoremap <expr><C-g> neocomplcache#undo_completion()
inoremap <expr><C-l> neocomplcache#complete_common_string()
inoremap <expr><CR> neocomplcache#complete_common_string()

" <TAB>: completion.
inoremap <expr><TAB> pumvisible() ? "\<C-n>" : "\<TAB>"
inoremap <expr><S-TAB> pumvisible() ? "\<C-p>" : "\<TAB>"

" <CR>: close popup
" <s-CR>: close popup and save indent.
inoremap <expr><s-CR> pumvisible() ? neocomplcache#close_popup()"\<CR>" : "\<CR>"
inoremap <expr><CR> pumvisible() ? neocomplcache#close_popup() : "\<CR>"

" <C-h>, <BS>: close popup and delete backword char.
inoremap <expr><BS> neocomplcache#smart_close_popup()."\<C-h>"
inoremap <expr><C-y> neocomplcache#close_popup()

" Enable omni completion.
autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS
autocmd FileType html,markdown setlocal omnifunc=htmlcomplete#CompleteTags
autocmd FileType javascript setlocal omnifunc=javascriptcomplete#CompleteJS
autocmd FileType python setlocal omnifunc=pythoncomplete#Complete
autocmd FileType xml setlocal omnifunc=xmlcomplete#CompleteTags
autocmd FileType ruby setlocal omnifunc=rubycomplete#Complete

" Enable heavy omni completion.
if !exists('g:neocomplcache_omni_patterns')
    let g:neocomplcache_omni_patterns = {}
endif
let g:neocomplcache_omni_patterns.php = '[^. \t]->\h\w*\|\h\w*::'
let g:neocomplcache_omni_patterns.perl = '\h\w*->\h\w*\|\h\w*::'
let g:neocomplcache_omni_patterns.c = '[^.[:digit:] *\t]\%(\.\|->\)'
let g:neocomplcache_omni_patterns.cpp = '[^.[:digit:] *\t]\%(\.\|->\)\|\h\w*::'
let g:neocomplcache_omni_patterns.ruby = '[^. *\t]\.\h\w*\|\h\w*::'

" For snippet_complete marker.
if has('conceal')
    set conceallevel=2 concealcursor=i
endif

" git gutter
highlight clear SignColumn
